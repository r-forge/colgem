<!-- Simple HIV model with acute infection -->

<beast version='2.0' namespace='master.beast:beast.core.parameter'>
  <run spec='InheritanceTrajectory'
	   samplePopulationSizes="true"
	   verbosity="1"
	   simulationTime="50"
	   >
	   

	<model spec='InheritanceModel' id='model'>
	  <population spec='Population' id='S' populationName='S'/>
	  <population spec='Population' id='I0' populationName='I0'/>
	  <population spec='Population' id='I1' populationName='I1'/>
	  
	  <reaction spec='InheritanceReaction' reactionName="Infection0" rate=".001">
			S:1 + I0:2 -> 2 I0:2
	  </reaction>
	  <reaction spec='InheritanceReaction' reactionName="Infection1" rate=".0001">
			S:1 + I1:2 -> I0:2 + I1:2
	  </reaction>
	  <reaction spec='InheritanceReaction' reactionName="Progression" rate="1">
			I0:1 -> I1:1
	  </reaction>
	  <reaction spec='InheritanceReaction' reactionName="Death" rate="0.1111">
			I1 -> 0
	  </reaction>
	  <reaction spec='InheritanceReaction' reactionName="Birth" rate=".01">
			S -> S + S
	  </reaction>
	</model>
	
	<initialState spec='InitState'>
	  <populationSize spec='PopulationSize' population='@S' size='999'/>
	  <populationSize spec='PopulationSize' population='@I1' size='0'/>
	  <lineageSeed spec='Individual' population='@I0' time="0"/> 
	</initialState>
	
	
	<inheritancePostProcessor spec='LineageSampler'
      nSamples="200"
      samplingTime="20"
      reverseTime="false"/>
	
	
	<output spec='NexusOutput' fileName='HIVModel.nexus'/>
	<output spec='JsonOutput' fileName='HIVModel.json'/>
  </run>
</beast>

<!--
#Visualize output in R
require(rjson)
d <- fromJSON(file='HIVModel.json')
plot(d$t, d$S, 'l', ylim=c(0, max(d$S)), col='blue')
lines(d$t, d$I0, col='red')
lines(d$t, d$I1, col='orange')

#compare to deterministic model
require(deSolve)
beta0 <- .001; beta1 <- .0001; gamma0 <- 1; gamma1 <- 0.1111; b <- .01
dY <- function(t, y, parms, ...){
l1 <- beta0 * y[2] 
l2 <- beta1 * y[3] 
list(unname(c(
 -l1*y[1]-l2*y[1] + b * y[1],
 l1*y[1]+l2*y[1] - gamma0 * y[2], 
 gamma0 * y[2] - gamma1 * y[3]
 )))
}
y0 <- c(999, 1, 0)
times <- d$t
o <- ode(y0, times, dY)
lines(o[,1], o[,2], col='blue')
lines(o[,1], o[,3], col='red')
lines(o[,1], o[,4], col='orange')

source('read_master.R') # loads the output tree 'HIVModel.nexus'
plot.phylo(tree)

-->
